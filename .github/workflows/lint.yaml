# ---
# FILE: .github/workflows/lint.yml
#
# PURPOSE: Runs all configured linters (e.g., Ruff, Prettier) on pull requests
# to enforce code style and standards.
#
# DESCRIPTION:
# Installs both Node.js and Python dependencies.
# Executes linters using pre-commit hooks.
#
# WARNING
# If you wait until this workflow fails rather than running the hooks locally
# regularly during development, then it likely going to be a huge pain
# to fix them all at once during the PR.
# Refer to the pre-commit hooks documentation for more information.
#
# DISCLAIMER: Do not edit this file unless explicitly permitted.
# This document serves as the single source of truth for development guidelines.
# Unauthorized changes can result in inconsistencies across repositories and disrupt the workflow.
# If you believe updates are necessary, consult the infrastructure team for review and approval.
# ---

name: lint

on: pull_request

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Set up python
        id: setup-python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Set PYTHONPATH
        run: echo "PYTHONPATH=${{ github.workspace }}" >> $GITHUB_ENV

      - name: Install Poetry
        uses: snok/install-poetry@v1
        with:
          version: 1.8.2
          virtualenvs-create: true
          virtualenvs-in-project: true
          installer-parallel: true

      - name: Install dependencies
        run: |
          poetry config http-basic.nexus ${{ secrets.ETHICS_NEXUS_MACHINE_USER }} ${{ secrets.ETHICS_NEXUS_MACHINE_PASSWORD }}
          poetry install --no-interaction --no-root

      - name: Run all linters
        run: |
          poetry run pre-commit run --all-files
